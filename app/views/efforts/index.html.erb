<h1>Recently Logged Effort</h1>

<div>
<% form_for @effort, :html => {:class => "InputArea", :style => "width:80%;"} do |form| %>
  <% form.error_messages %>
  <%= collection_select '', :project_id, @projects, :id, :name,
    {:prompt => 'Select Project'}, {:class => "logEffortDropBox"} %>
  <%= collection_select '', :phase_id, @phases, :id, :name, 
    {:prompt => 'Select Phase'}, {:class => "logEffortDropBox"} %>
  <%= form.collection_select :deliverable_id, @deliverables, :id, :name,
    {:prompt => 'Select Deliverable'},{:class => "logEffortDropBox"} %>
  <%= form.text_field :effort_date, :class => 'datepicker', :style => "width: 80px", :value => Time.now.strftime("%m/%d/%Y") %>
  <%= form.text_field :value, :style => "width: 30px;"%><%= " Hours " %>
  <%= form.submit 'Add Effort' %>
<% end %>
</div>

<% columns = [{:type => 'html'}, {:type => 'html'}, {:type => 'html'},{:type => 'html'}, {:type => 'html'}] %>
<%= datatable(columns, {:sort_by => "[4,'desc']", :per_page => 10}) %>
<div>
<table class='datatable' id="example">
  <thead>
  <th id="HeaderLeft">Project</th>
  <th>Phase</th>
  <th>Deliverable</th>
  <th>Effort (Hours)</th>
  <th>Last Updated</th>
  <th id="HeaderRight"></th>
</thead>
<tbody>
  <% for effort in @efforts %>
    <tr style="cursor:pointer"
      onClick="projectSelect(<%=
          "#{effort.deliverable.project_phase.project.id},
          #{effort.deliverable.project_phase.id},
          #{effort.deliverable.id})" %>"
        class="effortRow">
      <!-- % deliverable = Deliverable.find_by_id(effort.deliverable_id) %-->
      <td><%= effort.deliverable.project_phase.project.name %></td>
      <td><%= effort.deliverable.project_phase.name %> </td>
      <td><%=  effort.deliverable.name %></td>
      <td><%=  effort.value.round(1) %></td>
      <td><%=  effort.updated_at.to_s(:long) %></td>
      <td>
        <%=  link_to image_tag('/images/delete_icon.gif', :size => "15x15", :title => 'Delete effort for '+effort.deliverable.name, :alt => 'Delete effort for '+effort.deliverable.name),
          effort, :confirm => 'Are you sure to delete effort for '+effort.deliverable.name+'?', :method => :delete %>
      </td>
    </tr>
  <% end %>
  <% if @efforts.length == 0 %>
    <tr>
      <td colspan="7">You have not logged effort to any deliverables</td>
    </tr>
  <% end %>
</tbody>
</table>
</div>
<div class="cleaner"></div>



<script type="text/javascript">
   jQuery(".effortRow").hover(function () {
      startColor = jQuery(this).css('background-color');
      jQuery(this).css('background-color', "#E6FF99");
  }, function () {
    jQuery(this).css('background-color', startColor);
  });

<% for phase in @phases %>
    phases.push(new Array(<%= phase.project_id %>, '<%=h phase.name %>', <%= phase.id %>));
<%end%>
<% for deliverable in @deliverables %>
    deliverables.push(new Array(<%= deliverable.project_phase_id %>, '<%=h deliverable.name %>', <%= deliverable.id %>));
<%end%>
    projectSelect();
    phaseSelect();
</script>